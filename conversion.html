<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>繁簡轉換工具(保留原始格式)</title>
    <meta name="description" content="繁簡轉換工具(保留原始格式)" />
    <meta name="keywords" content="繁簡轉換工具(保留原始格式),工具" />
    <meta name="author" content="FeiFei" />
    <!-- Noto Sans TC 字體 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        .editable-area {
            min-height: 200px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px;
            overflow-y: auto;
            background-color: white;
        }
        .editable-area:focus {
            outline: none;
            border-color: #0069d9;
        }
        .is-readonly {
            background-color: #f8f9fa;
        }
        .copy-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }
        .copy-toast.show {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto p-4 max-w-4xl">
        <!-- 導航欄 -->
        <div class="flex flex-wrap gap-1 sm:gap-2 border-b mb-4">
            <a class="px-3 py-2 text-sm sm:text-base text-blue-600 hover:bg-blue-50 rounded-t" href="text-stats.html">文字統計</a>
            <a class="px-3 py-2 text-sm sm:text-base text-blue-600 border-b-2 border-blue-500 bg-blue-50 rounded-t" href="chinese-conversion.html">繁簡轉換</a>
            <a class="px-3 py-2 text-sm sm:text-base text-blue-600 hover:bg-blue-50 rounded-t" href="pdf-to-png.html">PDF 轉 PNG</a>
        </div>

        <h1 class="text-xl sm:text-2xl font-bold mb-4">繁簡轉換工具</h1>
        
        <div class="space-y-4 my-4">
            <!-- 輸入區域 -->
            <div class="field">
                <label class="block mb-2 font-medium">輸入文字:</label>
                <div id="input-text" class="editable-area" contenteditable="true" placeholder="在這裡輸入或貼上文字..."></div>
            </div>
            
            <!-- 按鈕區域 - RWD -->
            <div class="flex flex-col sm:flex-row sm:items-center gap-3">
                <div class="flex flex-wrap gap-2">
                    <button class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors flex-1 sm:flex-none min-w-[120px]" onclick="convertText('simplified')">
                        轉換為簡體
                    </button>
                    <button class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors flex-1 sm:flex-none min-w-[120px]" onclick="convertText('traditional')">
                        轉換為繁體
                    </button>
                </div>
                <div class="flex items-center space-x-2">
                    <input id="preserve-format" type="checkbox" checked class="w-4 h-4 cursor-pointer">
                    <label for="preserve-format" class="cursor-pointer select-none">保留原始格式</label>
                </div>
            </div>
            
            <!-- 輸出區域 -->
            <div class="field">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-2">
                    <label class="font-medium">輸出結果:</label>
                    <button id="copy-btn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded transition-colors flex items-center justify-center gap-2 w-full sm:w-auto" onclick="copyOutput()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                        </svg>
                        複製結果
                    </button>
                </div>
                <div id="output-text" class="editable-area is-readonly" contenteditable="false"></div>
            </div>
        </div>
    </div>

    <!-- 複製成功提示 -->
    <div id="copy-toast" class="copy-toast">已複製到剪貼簿！</div>

    <!-- Import opencc-js -->
    <script src="https://cdn.jsdelivr.net/npm/opencc-js@1.0.5/dist/umd/full.js"></script>
    <script>
        var converterS2T, converterT2S;

        function initConverters() {
            converterS2T = OpenCC.Converter({ from: 'cn', to: 'tw' });
            converterT2S = OpenCC.Converter({ from: 'tw', to: 'cn' });
        }

        function convertText(type) {
            const inputDiv = document.getElementById('input-text');
            const outputDiv = document.getElementById('output-text');
            const preserveFormat = document.getElementById('preserve-format').checked;
            let convertedContent;

            if (preserveFormat) {
                // 複製輸入內容
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = inputDiv.innerHTML;

                // 遍歷所有文本節點並轉換
                const walker = document.createTreeWalker(
                    tempDiv,
                    NodeFilter.SHOW_TEXT,
                    null,
                    false
                );

                let node;
                while (node = walker.nextNode()) {
                    if (node.textContent.trim()) {
                        node.textContent = type === 'simplified' 
                            ? converterT2S(node.textContent)
                            : converterS2T(node.textContent);
                    }
                }

                convertedContent = tempDiv.innerHTML;
            } else {
                // 不保留格式，直接轉換純文本
                const plainText = inputDiv.innerText;
                convertedContent = type === 'simplified' 
                    ? converterT2S(plainText)
                    : converterS2T(plainText);
            }

            outputDiv.innerHTML = convertedContent;
        }

        // 複製功能
        async function copyOutput() {
            const outputDiv = document.getElementById('output-text');
            const preserveFormat = document.getElementById('preserve-format').checked;
            const toast = document.getElementById('copy-toast');
            const copyBtn = document.getElementById('copy-btn');
            
            try {
                if (preserveFormat && outputDiv.innerHTML.trim()) {
                    // 複製 HTML 格式
                    const blob = new Blob([outputDiv.innerHTML], { type: 'text/html' });
                    const plainBlob = new Blob([outputDiv.innerText], { type: 'text/plain' });
                    
                    await navigator.clipboard.write([
                        new ClipboardItem({
                            'text/html': blob,
                            'text/plain': plainBlob
                        })
                    ]);
                } else {
                    // 複製純文本
                    await navigator.clipboard.writeText(outputDiv.innerText);
                }
                
                // 顯示成功提示
                toast.classList.add('show');
                copyBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                copyBtn.classList.add('bg-gray-500');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                    copyBtn.classList.remove('bg-gray-500');
                    copyBtn.classList.add('bg-green-500', 'hover:bg-green-600');
                }, 2000);
                
            } catch (err) {
                // 降級方案
                const textArea = document.createElement('textarea');
                textArea.value = outputDiv.innerText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 2000);
            }
        }

        // 為輸入區域添加提示文字功能
        const inputArea = document.getElementById('input-text');
        
        inputArea.addEventListener('focus', function() {
            if (this.innerHTML.trim() === '' || this.innerHTML.includes('color: #999')) {
                this.innerHTML = '';
            }
        });

        inputArea.addEventListener('blur', function() {
            if (this.innerHTML.trim() === '') {
                this.innerHTML = '<span style="color: #999;">' + this.getAttribute('placeholder') + '</span>';
            }
        });

        // 初始化轉換器和placeholder
        initConverters();
        inputArea.dispatchEvent(new Event('blur'));
    </script>
</body>
</html>
